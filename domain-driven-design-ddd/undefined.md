# 도메인 주도 설계 핵심

## 출처

* 반 버논의 도메인 주도 설계 핵심
* 반 버논의 Implementing Domain Driven Design

{% embed url="http://redutan.github.io/posts/" caption="redutan님의 블로그" %}

## 공부 기준

* 반 버논의 도메인 주도설계 핵심 1~7장까지 선 학습을 목표로한다.
* 상세한 내용은 출처의 IDDD, 기술 블로그를 활용한다.

## 1장

## 2장 바운디드 컨텍스트 및 보편언어와 전략적 설계 

### 챕터 용어정리

* Big ball of mud \(진흙덩어리\) 
* Bounded Context \(바운디드 컨텍스트\)
* Ubiquitous Language \(보편언어\)
* Collaboration Context \(협업 컨텍스트\)
* Problem Space \(문제 영역\)
* SoftWare Space \(해결 영역\)

### 바운디드 컨텍스트

* DDD는 바운디드 컨텍스트내 에서 보편언어를 모델링하는 것으로 이야기된다.
* 바운디드 컨텍스트는 의미적으로 동일한 컨텍스트의 범위를 표현한다.
  * 이 범위 내에서 소프트웨어 모델의 각 컴포넌트는 특정한 의미를 가지고 일을 수행한다.
  * 컨텍스트 내의 존재하는 컴포넌트는 컨텍스트에 특화되어 의미있게 활용된다.
* **문제 영역\(problem space\)**의 일부로 생각될 수 있으나, 설계되는 모델이 깊은 의미와 명확성을 가지게 되면 바운디드 컨텍스트는 **해결영역\(software space\)**로 전환되고 모델들은 프로젝트 소스 코드에 반영된다.
  * 문제영역
    * 상위수준의 전략적 분석을 수행하고 주어진 프로젝트 제약사항 내에서 단계를 설계하는 영역
    * 프로젝트 요인, 주요목표와 위험 사항에 대해서 논의시 간단한 다이어그램을 활용한다.
    * 실제 예로 컨텍스트 맵은 문제 영역에서 잘 활용된다.
    * 필요에 따라 해결 영역과 밀접한 영역을 가지게된다.
  * 해결영역
    * 문제영역의 논의가 핵심 도메인으로 바라보는 해결 방안을 구현하는 곳이다.
    * 바운디드 컨텍스트를 조직의 핵심 전략계획으로  개발시 이를 핵심 도메인이라고 한다.
    * 바운디드 컨텍스트 내에서 메인, 테스트 코드로 해결 방안을 개발한다.
    * 타 바운디드 컨텍스트와의 통합을 지원하는 해결 영역에서도 코드를 생산한다.
* 즉 바운디드 컨텍스트는 일정한 범위내에 의미를 가지는 모델들이 구현되는 곳이며, 각 바운디드 컨텍스트는 각각의 분리된 소프트웨어 산출물이 나온다.
* 우리가 사용하는 인간의 언어도 국경을 넘어가면 그 경계가 명확하다. 바운디드 컨텍스트 또한 유사한 의미를 가지고 있다.
* 단일팀만 할당되어야하며 각 바운디드 컨텍스트 마다 독립적인 소스코드 리포지토리가 필요로 한다.
* 한 팀이 다수의 바운디드 컨텍스트를 운용이 가능하나, 여러팀이 한 바운디드 컨텍스트를 수행하지 않는다.
  * 이는 다수의 팀이 수행할 경우 발생되는 문제를 원천차단하기 위함이다.
  * 동음이의어 와같은 상황이 발생되는데 비즈니스 지식들이 다른 컨텍스트에 존재하기 때문이다.
  * 타 팀과의 소통은 공식 인터페이스를 정의하여 담당한 바운디드 컨텍스트를 다른 팀이 사용할 수있게 허용한다.
  * 이것이 DDD의 사용의 이점이다.
* 보편언어를 나눈것과 같은 방법으로 바운디드 컨텍스트 마다 소스코드, 스키마 역시 명확하게 분리해야한다.
* 메인 소스 및 단위, 인수 테스트 역시 유지해야한다.
* 바운디드 컨텍스트를 사용하는 이유는  각팀이 각 도메인을 작고 관리할 수있는 정도에서 시작한다 할지라도 수많은 개념이 쌓이는 것을 언제까지 누적해야하는가 판단이 안설 경우가 있다.
* 각 팀은 더 많은 개념을 추가하게되면서 하나의  거대,혼란,경계가 제한되지 않은 모델안에서 너무 많은 개념이 존재하는 것은 물론 실제로 다수의 언어가 혼재 되면서 점차 모델내의 언어가 모호해지기 시작한다.
* 위와 같은 상황에서 각 팀이 소프트웨어 제품을 진흙 덩어리로 만들어버린다.
* 이러한 모델을 사용하게 된다면 큰 문제가 발생되어 알수없게 확장되거나 어울리지 않는 모듈을 상호 연계될 가능성도 존재한다. 이는 테스트 시간의 중가와 건너뛰는 현상을 초례할 수있다. 개판이라는 것이다.

### 보편언어

* 컨텍스트 범위 내의 소프트웨어 모델은 바운디드 컨텍스트 안에서 일하는 팀이 생성하고 소프트웨어 모델을 구현하는 모든 팀 구성원이 사용하는 언어를 반영한다.
* 이 언어는 팀 구성원이 이야기 시 사용되고 소프트웨어 모델 안에서 구현되기에 보편언어라고 불리운다.
* 팀 모두가 보편언어로 표현된 의미에 대한 제약사항과 정확한 의미를 이해해야한다.
* 이 언어의 대표적인 기록형태는 소프트웨어 모델의 소스 코드이다.

### 핵심 도메인

* 핵심 도메인은 다음과 같은 목표를 가진다.
  * 가치있는 것들을 달성하기 위한 수단
  * 다른 조직과 경쟁에 대한 차별화
  * 최소한 하나의 주요한 사업 부분을 다룬다.
  * 기업이 올바른 정략을 결정하기 위해 무엇이 핵심 도메인인지 분별해야한다.

### 도메인 전문가와 비즈니스 동인

* 비즈니스 이해관계자들에게서 기술팀은 더 나은 모델을 설계시 도움이 되는 힌트를 얻어낼 수 있다.
* 이들과 협업을 하지 않을 경우 제멋대로 노력한 결과가 나올 뿐이다.
* 그렇기에 각 사업 기능마다 비즈니스 전문가를 두는 경우가 많다. 조직의 구분4과 기능에 대해 관점을 가지고 생각해야한다.
* 예를들어 **정책**\(policy\)이라는 것이 각 기능에 따라 얼마나 다른 의미를 가지는지 살펴본다.
  * 계약심사 내 정책
    * 계약심사를 담당하는 전문부서에서 피보험 자산에 대한 위험평가를 기반으로 정책을 세운다.
  * 검사 내 정책
    * 보험사가 손해 보험관련 업무시 계약 심사시 자산의 검사를 책임지는 검사 전문부서가 존재한다. 보험사는 피보험인이 주장한 자산의 상태만 믿는 것이 아니라 어느정도 검사를 통해 확인된 정보를 의존한다.
    * 자산이 계약심사의 대상이 되는 경우 사진이나 기록등 검사 세부사항은 검사 부서의 정책과 관련이 있고, 계약심사 부서에서는 그 자료를 최종 보험료를 협상하는데 사용할 수 있다.
  * 청구 내 정책
    * 청구 전문부서의 정책은 계약 심사부서에서 세운 정책의 조건에 따라 계약심사된 보험료 지불요청내역을 추적한다.
    * 청구 정책의 일부는 계약 심사의 정책에도 나타나지만 보험에 계약된 심사된 자산에대한 손해와 지급액 결정을 위해 청구 담당자가 수행하는 검토등에 사용할 정책처럼 그 어떤 것이든 청구 관점에서 정책이 세워저야할 것이다.
* 위와 같은  세가지 정책을 모두 하나의 정책으로 통합하려 하면 많은 문제가 발생 될 것이다. 시작도 안한 제4의 제5의 사업개념까지 지원하기위해 과부화 상태까지 왔다면 문제는 커지고 아무도 해결이 불가능하다.
* 이러한 점을 해결하기위해 DDD는 서로 다른 개념들을 각기 다른 바운디드 컨텍스트안에 분리하여 개념간 차이를 더욱 중시한다.
* 위와같은점은 각기 다른 언어와 그에 따른 기능이 존재함을 인정하는 것이다. 한마디로 정리하여 계약심사 내 정책, 검사 내 정책, 청구 내 정책으로 구분 두는 것이 아니라 바운디드 컨텍스트 내에서 정책을 정책이라는 의미로 그대로 사용하는 것이다.
* 그외의 비행이라는 단어도 다양한게 구분되기에 바운디드 컨텍스트로 관리하길 권장되는 것으로 보인다.

### 바운디드 컨텍스트를 사용해야하는 이유와 그에 따른 사례 연구

* 도메인 모델 사례를 예를 들어 설명하며 구체적인 사례를 살펴본다.
* 스크럼 기반 애자일 프로젝트 관리 어플리케이션 작업을 살펴본다.
* 위 작업을 표현하기 위해서 많은 개념을 트리 구조로 살을 붙여나가지만 진흙 덩어리를 만들게 되버린다. 그럼 어떻게 해결해야 하는게 옳은가?\(책과 같이 설명해야 한다.\)
* 바로 전략절 설계를 하기위한 DDD의 도구인 바운디드 컨텍스트와 보편언어가 이에 해당되는 것이다.
* 첫쨰로 도메인 전문가와 개발자를 하나로 묶어 협업하는 님을 구성해야한다.

### 도메인 전문가

* 비즈니스 문제에 대해 포커스를 두고 비즈니스의 흐름에 대해서 비전을 가진다.
* 스크럼 도메인에서 스크럼이 프로젝트에서 어떻게 실행되는지 완벽하게 이해하고 있는 스크럼 마스터가 바로 도메인 전문가다.
* 스크럼 제품 책임자와 DDD 도메인 전문가 사이에 어떤 차이가 있는지 궁금할 수 있다. 동일할 수도 아닐수도 있다.
* 하지만 제품 책임자는 제품의 백로그를 관리하고 우선순위를 정하는 것 그리고 프로젝트의 개념적이고 기술적인 연관성이 유지되도록하는것에 신경쓰는 것이 바람직하나, 비즈니스의 핵심 경쟁력의 전문가가 될 필요는 없다.
* 고로 팀내에 진짜 도메인 전문가를 포용하여 하며 제품 책임자가 그를 대신해선 안된다.

### 개발자

* 소프트웨어 개발에 중점을 둔다.
* 핵심 전략 목표의 비즈니스 초점을 받아들이지 못하는 기술중심의 주장을 하지 말아야한다.
* 근거없는 간결성은 피하며, 해당 팀의 바운디드 컨텍스트 안에 팀이 점진적으로 개발하는 보편언어를 수용해야한다.
* DDD를 사용하는 목적은 _**기술적인 측면보다 비즈니스 모델의 복잡도가 매우 높기에 사용한다.**_ ****필요 이상의 복잡한 모델링은 삼가하고 도메인 전문가와 함께 비즈니스 모델을 파악해야만 한다
* 도메인 전문가와 개발자는 모두 문서가 대화를 지배하는 상황을 피해야하고 최고의 보편언어를 협업에 의한 피드백으로 산출해야한다. 이로서 화합된 멘탈 모델을 구성할 수 있다. 열린사고와 깊은 탐구를 현재의 지식기반에 대한도전을 통해 핵심도메인에 대한 통찰을 얻어야한다.

### 도전과 통합

* 진흙 덩어리를 해결하기 위해선 바운디드 컨텍스트 내에서 보편언어를 따르는가 확인해보는 관점을 가져야한다.

![Big Ball of Mud &#xC758; &#xD55C; &#xC0AC;&#xB840;](../.gitbook/assets/image%20%2834%29.png)

### 차례대로 스크럼 바운디 컨텍스트의 구조를 잡아보자

{% tabs %}
{% tab title="상관이 없으나 대체가 될 가능성이 있는 경우" %}
![](../.gitbook/assets/image%20%2843%29.png)



![](../.gitbook/assets/image%20%2857%29.png)

* 스크럼과 아무 상관이 없는 Tenant와 그 하위 소프트웨어 모델을 제외시켰다.
* 제외된 소프트웨어 모델은 스크럼 애자일 컨텍스트 내의 보편언어인 Team, ProductOwner, TeamMember에 더 합리적이고 어울리므로 소프트웨어 모델에 대체가 된다.
* 이런 식으로 필요한데 대체할 수 있는지 확인해보아야 한다.
{% endtab %}

{% tab title="컨텍스트에 해당하는 하위모델과 그렇지 않은 경우" %}
![](../.gitbook/assets/image%20%2842%29.png)

* SupportPlans, Payment는  스크럼 프로젝트 관리의 일부로 볼 수 없다.
* 핵심 스크럼 언어가 아니기 때문이므로 컨텍스트 내의 소프트웨어 모델에서 제외해야한다.
{% endtab %}

{% tab title="필요에 의해서 추가된 경우" %}
![](../.gitbook/assets/image%20%2835%29.png)

* 인적 자원 활용 문제에 때문에 추가된 소프트웨어 모델은 유용할 수도 있다.
* 그러나 BacklogItemTask를 진행할 팀 자원자가 직접 사용하지 않는 다고 생각하므로 제외된다.
{% endtab %}

{% tab title="핵심 개념을 놓친 경우" %}
![](../.gitbook/assets/image%20%2812%29.png)

* TeamMemeber가 작업에 참여하는 핵심개념을 놓치고있다.
* Volunteer\(지원자\) 개념이 컨텍스트 내에 존재하므로 핵심 언어모델에 포함한다.
{% endtab %}

{% tab title="추후 모델링을 고려하는 경우" %}
![](../.gitbook/assets/image%20%2826%29.png)

* 일정에 대한 소프트웨어 모델을 고려했을때 Milestone\(이정표\), Retrospective\(회고\) 등은 컨텍스트 내에 존재하나 모델링 작업을 다음 스프린트에서 한다고 가정을 한 경우, 현재 시점에서는 범위 밖에 있다.
{% endtab %}

{% tab title="소프트웨어 모델 설계자가 표현을 하고 싶을 때" %}
![](../.gitbook/assets/image%20%2864%29.png)

* 설계자가 핵심 모델의 일부라고 생각하는 Discussion을 명확하게 표현하고자 하여 컨텍스트 내 포함을 시켰다.
*  Discussion이 팀의 보편언어 중 일부이며 바운디드 컨텍스트 내에 있다는 의미를 나타내게 된다.
{% endtab %}

{% tab title="협업 컨텍스트에 대하여" %}
![](../.gitbook/assets/image%20%2817%29.png)

* Discussion에 대한 보편언어가 필요한 의미를 충분히 표현했는가 확인해 봐야한다.
* 지원하는 부수적인 소프트웨어 컴포넌트가 필요한데, 스크럼의 바운디드 컨텍스트 내에 표현하기 적합하지 않아 별도의  다른 바운디드 컨텍스트와 협업을 통해 적절하게 동작할 것이라 설명되고 협업 컨텍스트로 불린다.
{% endtab %}

{% tab title="핵심 도메인에 대한 고찰" %}
![](../.gitbook/assets/image%20%2814%29.png)

* 과정과 과정을 반복하여 간결한 핵심 도메인만 남았지만 여전히 확장되어 나갈 것이다.
* 시간이 지남에 따라 역시 새로은 소프트웨어 모델이 개발될 것이다.
* 그렇다 하여도 스크럼의 보편언어에 따른 새로운 개념들로만 확장되어야 한다.
{% endtab %}

{% tab title="제외된 다른 모델링 개념에 대하여" %}
![](../.gitbook/assets/image%20%2866%29.png)

* 또다른 바운디드 컨텍스트 내에 위치할 가능성이 있으며 해당 컨텍스트 내의 보편언어에 연결될 것이다.
* 이후 컨텍스트 매핑이라는 것을 통해 통합하는 방법을 배워나가야한다.
{% endtab %}
{% endtabs %}

## 3장

## 4장

## 5장

## 6장

## 7장

